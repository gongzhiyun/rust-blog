<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="660" viewBox="0 0 800 660" xmlns="http://www.w3.org/2000/svg">
<defs>
    <!-- 渐变定义 -->
    <linearGradient id="grad-stack" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style="stop-color:#e3f2fd;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#bbdefb;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="grad-mask-blue" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#2196f3;stop-opacity:0.1" />
        <stop offset="100%" style="stop-color:#2196f3;stop-opacity:0.3" />
    </linearGradient>
    <linearGradient id="grad-mask-green" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#4caf50;stop-opacity:0.1" />
        <stop offset="100%" style="stop-color:#4caf50;stop-opacity:0.3" />
    </linearGradient>
    <!-- 阴影定义 -->
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="3" />
        <feOffset dx="2" dy="2" result="offsetblur" />
        <feComponentTransfer>
            <feFuncA type="linear" slope="0.1" />
        </feComponentTransfer>
        <feMerge>
            <feMergeNode />
            <feMergeNode in="SourceGraphic" />
        </feMerge>
    </filter>
</defs>
<rect width="800" height="660" fill="#f4f7f9"/>
<!-- 总标题 -->
<text x="400" y="40" font-family="JetBrains Mono, monospace" font-size="24" font-weight="bold" fill="#2c3e50" text-anchor="middle">Rust 内存布局与零成本抽象</text>
<!-- 1. ZST 卡片 -->
<g transform="translate(40, 70)">
    <!-- 卡片背景 -->
    <rect width="720" height="230" rx="12" fill="#ffffff" filter="url(#shadow)"/>
    <text x="20" y="30" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#8e44ad">PART 1: ZST (Zero Sized Type) - 逻辑标记</text>
    <!-- 代码区 -->
    <g transform="translate(20, 50)">
        <rect width="240" height="150" rx="8" fill="#f8f9fa" stroke="#e0e0e0" stroke-width="1"/>
        <text x="15" y="35" font-family="JetBrains Mono, monospace" font-size="13" fill="#34495e">struct Container {</text>
        <text x="30" y="65" font-family="JetBrains Mono, monospace" font-size="13" fill="#2196f3">    a: u8,       <tspan fill="#95a5a6" font-size="11">// 1B</tspan></text>
        <text x="30" y="95" font-family="JetBrains Mono, monospace" font-size="13" fill="#8e44ad" font-weight="bold">    b: Empty,    <tspan fill="#95a5a6" font-size="11" font-weight="normal">// 0B</tspan></text>
        <text x="30" y="125" font-family="JetBrains Mono, monospace" font-size="13" fill="#2196f3">    c: u8,       <tspan fill="#95a5a6" font-size="11">// 1B</tspan></text>
        <text x="15" y="150" font-family="JetBrains Mono, monospace" font-size="13" fill="#34495e" dy="-5">}</text>
    </g>
    <!-- 转换箭头 -->
    <path d="M 280 125 L 340 125" stroke="#bdc3c7" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
    <!-- 内存图示 -->
    <g transform="translate(380, 70)">
        <rect x="0" y="30" width="100" height="60" rx="4" fill="url(#grad-stack)" stroke="#2196f3" stroke-width="1.5"/>
        <text x="50" y="65" font-family="JetBrains Mono, monospace" font-size="13" fill="#1565c0" text-anchor="middle" font-weight="bold">字段 a (1B)</text>
        <rect x="100" y="30" width="100" height="60" rx="4" fill="url(#grad-stack)" stroke="#2196f3" stroke-width="1.5"/>
        <text x="150" y="65" font-family="JetBrains Mono, monospace" font-size="13" fill="#1565c0" text-anchor="middle" font-weight="bold">字段 c (1B)</text>
        <g transform="translate(100, 30)">
            <line x1="0" y1="-10" x2="0" y2="70" stroke="#8e44ad" stroke-width="2" stroke-dasharray="4,2"/>
            <circle cx="0" cy="30" r="5" fill="#8e44ad" fill-opacity="0.3" stroke="#8e44ad" stroke-width="1"/>
            <text x="0" y="-20" font-family="JetBrains Mono, monospace" font-size="12" fill="#8e44ad" text-anchor="middle" font-weight="bold">幽灵字段 b (0B)</text>
        </g>
    </g>
</g>
<!-- 2. Newtype 卡片 -->
<g transform="translate(40, 330)">
    <!-- 卡片背景 -->
    <rect width="720" height="290" rx="12" fill="#ffffff" filter="url(#shadow)"/>
    <text x="20" y="30" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#27ae60">PART 2: Newtype - 语义包装</text>
    <!-- 代码区 -->
    <g transform="translate(20, 50)">
        <rect width="240" height="80" rx="8" fill="#f8f9fa" stroke="#e0e0e0" stroke-width="1"/>
        <text x="15" y="35" font-family="JetBrains Mono, monospace" font-size="13" fill="#27ae60" font-weight="bold">struct Meters(u32);</text>
        <text x="15" y="65" font-family="JetBrains Mono, monospace" font-size="12" fill="#95a5a6">// 内存布局等同于 u32</text>
    </g>
    <!-- 透视镜布局 -->
    <g transform="translate(280, 20)">
        <!-- 视角 A -->
        <g transform="translate(0, 0)">
            <rect width="190" height="70" rx="10" fill="url(#grad-mask-blue)" stroke="#2196f3" stroke-width="1.5"/>
            <text x="95" y="30" font-family="JetBrains Mono, monospace" font-size="13" fill="#1565c0" text-anchor="middle" font-weight="bold">视角 A: u32</text>
            <text x="95" y="52" font-family="JetBrains Mono, monospace" font-size="11" fill="#34495e" text-anchor="middle">解读为“纯数值类型”</text>
        </g>
        <!-- 视角 B -->
        <g transform="translate(230, 0)">
            <rect width="190" height="70" rx="10" fill="url(#grad-mask-green)" stroke="#27ae60" stroke-width="1.5"/>
            <text x="95" y="30" font-family="JetBrains Mono, monospace" font-size="13" fill="#1b5e20" text-anchor="middle" font-weight="bold">视角 B: Meters</text>
            <text x="95" y="52" font-family="JetBrains Mono, monospace" font-size="11" fill="#34495e" text-anchor="middle">解读为“长度语义”</text>
        </g>
        <!-- 物理真相 (内存框图形式) -->
        <g transform="translate(30, 110)">
            <!-- 4字节内存块 -->
            <rect width="360" height="60" rx="4" fill="url(#grad-stack)" stroke="#34495e" stroke-width="1.5"/>
            <text x="180" y="38" font-family="JetBrains Mono, monospace" font-size="14" fill="#2c3e50" text-anchor="middle" font-weight="bold">u32 数据块 (4 Bytes)</text>
            
            <!-- 内存刻度/地址感 -->
            <line x1="90" y1="0" x2="90" y2="60" stroke="#34495e" stroke-width="1" stroke-dasharray="2,2" opacity="0.5"/>
            <line x1="180" y1="0" x2="180" y2="60" stroke="#34495e" stroke-width="1" stroke-dasharray="2,2" opacity="0.5"/>
            <line x1="270" y1="0" x2="270" y2="60" stroke="#34495e" stroke-width="1" stroke-dasharray="2,2" opacity="0.5"/>
            
            <text x="180" y="85" font-family="JetBrains Mono, monospace" font-size="12" fill="#7f8c8d" text-anchor="middle">物理真相：在内存中只是一个普通的 u32</text>
            
            <!-- 连接虚线 -->
            <path d="M 65 -40 L 90 0" stroke="#2196f3" stroke-width="1.5" stroke-dasharray="4,2" opacity="0.6"/>
            <path d="M 295 -40 L 270 0" stroke="#27ae60" stroke-width="1.5" stroke-dasharray="4,2" opacity="0.6"/>
        </g>
    </g>
    <!-- 底部结论 -->
    <rect x="130" y="245" width="460" height="28" rx="14" fill="#fff7ed" stroke="#fb923c" stroke-width="1"/>
    <text x="360" y="264" font-family="JetBrains Mono, monospace" font-size="12" fill="#ea580c" text-anchor="middle" font-weight="bold">编译期：类型检查与方法分发 | 运行期：包装彻底消失，零成本</text>
</g>
<!-- 定义箭头 -->
<defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#bdc3c7" />
    </marker>
</defs>
</svg>
