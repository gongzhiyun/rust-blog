<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="500" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
  <!-- Background -->
  <rect width="800" height="500" fill="#f8f9fa" />
  
  <!-- Title -->
  <text x="400" y="40" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" fill="#333333" text-anchor="middle">VecDeque 内存布局 (Modern Rust: head + len)</text>

  <!-- Stack Section -->
  <rect x="50" y="80" width="220" height="380" rx="15" fill="#ffffff" stroke="#e0e0e0" stroke-width="2" />
  <path d="M 50 115 L 270 115" stroke="#e0e0e0" stroke-width="2" />
  <rect x="50" y="80" width="220" height="35" rx="15" fill="#e3f2fd" />
  <text x="160" y="103" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1565c0" text-anchor="middle">Stack (栈)</text>
  
  <!-- VecDeque Struct -->
  <rect x="70" y="140" width="180" height="200" rx="8" fill="#ffffff" stroke="#ef5350" stroke-width="2" />
  <text x="160" y="130" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#ef5350" text-anchor="middle">VecDeque&lt;T&gt;</text>
  
  <!-- Fields -->
  <rect x="80" y="150" width="160" height="40" rx="4" fill="#fff8e1" stroke="#ff9800" stroke-width="1" />
  <text x="90" y="175" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">buf (ptr):</text>
  <text x="230" y="175" font-family="JetBrains Mono, monospace" font-size="11" fill="#78909c" text-anchor="end">0x55A0...</text>

  <rect x="80" y="200" width="160" height="40" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
  <text x="90" y="225" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">cap (usize):</text>
  <text x="230" y="225" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333" text-anchor="end">8</text>

  <rect x="80" y="250" width="160" height="40" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
  <text x="90" y="275" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">head (usize):</text>
  <text x="230" y="275" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333" text-anchor="end">6</text>

  <rect x="80" y="300" width="160" height="40" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
  <text x="90" y="325" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">len (usize):</text>
  <text x="230" y="325" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333" text-anchor="end">4</text>

  <!-- Heap Section -->
  <rect x="320" y="80" width="430" height="380" rx="15" fill="#ffffff" stroke="#e0e0e0" stroke-width="2" />
  <path d="M 320 115 L 750 115" stroke="#e0e0e0" stroke-width="2" />
  <rect x="320" y="80" width="430" height="35" rx="15" fill="#e8f5e9" />
  <text x="535" y="103" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#2e7d32" text-anchor="middle">Heap (堆: Ring Buffer)</text>

  <!-- Ring Buffer Blocks -->
  <!-- Index 0 -->
  <rect x="340" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#4caf50" stroke-width="2" />
  <text x="360" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#2e7d32" text-anchor="middle">D2</text>
  <text x="360" y="230" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c" text-anchor="middle">[0]</text>
  
  <!-- Index 1 -->
  <rect x="390" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#4caf50" stroke-width="2" />
  <text x="410" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#2e7d32" text-anchor="middle">D3</text>
  <text x="410" y="230" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c" text-anchor="middle">[1]</text>

  <!-- Index 2 (Empty) -->
  <rect x="440" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="4 2" />
  <text x="460" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#bdbdbd" text-anchor="middle">-</text>
  <text x="460" y="230" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c" text-anchor="middle">[2]</text>

  <!-- Index 3-5 (Empty) -->
  <rect x="490" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="4 2" />
  <rect x="540" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="4 2" />
  <rect x="590" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="4 2" />
  <text x="565" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#bdbdbd" text-anchor="middle">Empty</text>

  <!-- Index 6 (Head) -->
  <rect x="640" y="150" width="40" height="60" rx="4" fill="#fff8e1" stroke="#ff9800" stroke-width="2" />
  <text x="660" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#f57c00" text-anchor="middle">D0</text>
  <text x="660" y="230" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c" text-anchor="middle">[6]</text>
  <text x="660" y="140" font-family="JetBrains Mono, monospace" font-size="10" font-weight="bold" fill="#ff9800" text-anchor="middle">HEAD</text>

  <!-- Index 7 -->
  <rect x="690" y="150" width="40" height="60" rx="4" fill="#ffffff" stroke="#4caf50" stroke-width="2" />
  <text x="710" y="185" font-family="JetBrains Mono, monospace" font-size="12" fill="#2e7d32" text-anchor="middle">D1</text>
  <text x="710" y="230" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c" text-anchor="middle">[7]</text>

  <!-- Logic Arrow: ptr to Heap -->
  <path d="M 240 170 Q 280 170 320 170" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead)" />
  
  <!-- Markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
    </marker>
  </defs>

  <!-- Explanation -->
  <rect x="340" y="300" width="390" height="120" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1" stroke-dasharray="4 2" />
  <text x="355" y="325" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#6a1b9a">逻辑计算:</text>
  <text x="355" y="350" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">1. Logical Index (i) -&gt; Physical Index (p)</text>
  <text x="355" y="370" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">   p = (head + i) % cap</text>
  <text x="355" y="390" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">2. Tail 物理位置 (逻辑末尾的下一个):</text>
  <text x="355" y="410" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">   tail_next = (head + len) % cap = (6 + 4) % 8 = 2</text>

</svg>
