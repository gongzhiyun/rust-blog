<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="500" viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="500" fill="#f8f9fa" />
    
    <!-- Title -->
    <text x="400" y="30" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" text-anchor="middle" fill="#333333">为什么预分配（订位）更高效？</text>

    <!-- Scenario A: No Hint (Reallocation) -->
    <g transform="translate(50, 70)">
        <text x="0" y="0" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#ef5350">方案 A：没预判（反复搬桌子）</text>
        
        <!-- Step 1 -->
        <g transform="translate(0, 30)">
            <rect width="40" height="30" fill="#ffebee" stroke="#ef5350" />
            <text x="5" y="20" font-family="JetBrains Mono, monospace" font-size="10" fill="#ef5350">Cap:1</text>
            <text x="50" y="20" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">← 第 1 个人来</text>
        </g>
        
        <!-- Step 2 (Move) -->
        <g transform="translate(0, 70)">
            <path d="M 20 0 L 20 20" fill="none" stroke="#ef5350" stroke-width="1" stroke-dasharray="2" marker-end="url(#arrowhead_red)" />
            <rect width="80" height="30" fill="#ffebee" stroke="#ef5350" />
            <text x="5" y="20" font-family="JetBrains Mono, monospace" font-size="10" fill="#ef5350">Cap:2</text>
            <text x="90" y="20" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">← 第 2 个人来，搬家！</text>
        </g>
        
        <!-- Step 3 (Move) -->
        <g transform="translate(0, 110)">
            <path d="M 40 0 L 40 20" fill="none" stroke="#ef5350" stroke-width="1" stroke-dasharray="2" marker-end="url(#arrowhead_red)" />
            <rect width="160" height="30" fill="#ffebee" stroke="#ef5350" />
            <text x="5" y="20" font-family="JetBrains Mono, monospace" font-size="10" fill="#ef5350">Cap:4</text>
            <text x="170" y="20" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">← 第 3 个人来，再搬家！</text>
        </g>
        
        <text x="0" y="170" font-family="JetBrains Mono, monospace" font-size="12" fill="#ef5350" font-style="italic">代价：申请新内存 + 拷贝旧数据 + 释放旧内存 (耗时)</text>
    </g>

    <!-- Divider -->
    <line x1="400" y1="60" x2="400" y2="450" stroke="#e0e0e0" stroke-width="2" stroke-dasharray="5" />

    <!-- Scenario B: With Hint (Reservation) -->
    <g transform="translate(450, 70)">
        <text x="0" y="0" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#4caf50">方案 B：有预判（提前订大桌）</text>
        
        <!-- Reservation Ask -->
        <g transform="translate(0, 30)">
            <rect width="200" height="40" rx="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
            <text x="100" y="25" font-family="JetBrains Mono, monospace" font-size="12" text-anchor="middle" fill="#9c27b0">size_hint() -> 最多 10 人</text>
        </g>
        
        <!-- One-time Allocation -->
        <g transform="translate(0, 90)">
            <rect width="300" height="40" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
            <text x="5" y="25" font-family="JetBrains Mono, monospace" font-size="10" fill="#4caf50">Capacity: 10 (一次搞定)</text>
            
            <!-- People entering -->
            <rect x="5" y="50" width="25" height="25" fill="#fff8e1" stroke="#ff9800" />
            <rect x="35" y="50" width="25" height="25" fill="#fff8e1" stroke="#ff9800" />
            <rect x="65" y="50" width="25" height="25" fill="#fff8e1" stroke="#ff9800" />
            <rect x="95" y="50" width="25" height="25" fill="#eeeeee" stroke="#bdbdbd" stroke-dasharray="2" />
            <text x="130" y="70" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">直接入座，无需搬桌</text>
        </g>
        
        <text x="0" y="200" font-family="JetBrains Mono, monospace" font-size="12" fill="#4caf50" font-style="italic">优势：1 次申请，0 次拷贝，效率极高</text>
    </g>

    <!-- Bottom Legend -->
    <rect x="100" y="420" width="600" height="50" rx="10" fill="#fff8e1" stroke="#ff9800" stroke-width="1" />
    <text x="400" y="450" font-family="JetBrains Mono, monospace" font-size="14" text-anchor="middle" fill="#333333">总结：collect 优先向迭代器索要“预估人数”，从而选择方案 B</text>

    <!-- Definitions -->
    <defs>
        <marker id="arrowhead_red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ef5350" />
        </marker>
    </defs>
</svg>
