<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="720" viewBox="0 0 800 720" xmlns="http://www.w3.org/2000/svg">
  <rect width="800" height="720" fill="#f8f9fa" rx="20"/>
  
  <!-- Title -->
  <text x="400" y="45" font-family="JetBrains Mono, monospace" font-size="24" font-weight="bold" fill="#333" text-anchor="middle">GATs 实战：为什么我们需要它？</text>
  <text x="400" y="72" font-family="JetBrains Mono, monospace" font-size="14" fill="#455a64" text-anchor="middle">从“复制数据”到“借用数据”的抽象进化</text>

  <!-- Scenario 1: The Copy Trap (Without GATs) -->
  <g transform="translate(40, 100)">
    <rect width="340" height="280" fill="#ffffff" stroke="#e0e0e0" stroke-width="2" rx="12"/>
    <text x="170" y="30" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#333" text-anchor="middle">1. 无 GATs：被迫搬运数据</text>
    
    <!-- Buffer -->
    <rect x="30" y="60" width="120" height="100" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="6"/>
    <text x="90" y="115" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#0d47a1" text-anchor="middle">大内存 Buffer</text>
    
    <!-- Item (New Copy) -->
    <rect x="220" y="85" width="90" height="50" fill="#ffebee" stroke="#ef5350" stroke-width="2" rx="6"/>
    <text x="265" y="115" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#c62828" text-anchor="middle">新克隆数据</text>
    
    <!-- The Movement -->
    <path d="M150 110 L210 110" fill="none" stroke="#ef5350" stroke-width="2" marker-end="url(#arrow-red)"/>
    <text x="180" y="100" font-family="JetBrains Mono, monospace" font-size="10" fill="#c62828" text-anchor="middle" font-weight="bold">必须 Clone</text>
    
    <text x="170" y="190" font-family="JetBrains Mono, monospace" font-size="11" fill="#455a64" text-anchor="middle">因为关联类型 Item 无法借用 self</text>
    <text x="170" y="210" font-family="JetBrains Mono, monospace" font-size="11" fill="#455a64" text-anchor="middle">你不得不把数据复制一份扔出来</text>
    
    <rect x="20" y="235" width="300" height="30" fill="#fff3e0" rx="4"/>
    <text x="170" y="255" font-family="JetBrains Mono, monospace" font-size="11" fill="#e65100" text-anchor="middle">代价：性能低下，内存翻倍</text>
  </g>

  <!-- Scenario 2: The Lending Bridge (With GATs) -->
  <g transform="translate(420, 100)">
    <rect width="340" height="280" fill="#ffffff" stroke="#e0e0e0" stroke-width="2" rx="12"/>
    <text x="170" y="30" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#333" text-anchor="middle">2. 有 GATs：精准窗口观察</text>
    
    <!-- Buffer -->
    <rect x="30" y="60" width="120" height="100" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" rx="6"/>
    <text x="90" y="115" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#0d47a1" text-anchor="middle">大内存 Buffer</text>
    
    <!-- Item (Reference) -->
    <rect x="220" y="85" width="90" height="50" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" stroke-dasharray="4,2" rx="6"/>
    <text x="265" y="115" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#2e7d32" text-anchor="middle">&amp;数据引用</text>
    
    <!-- The View -->
    <path d="M150 110 L210 110" fill="none" stroke="#4caf50" stroke-width="2" marker-end="url(#arrow-green)"/>
    <text x="180" y="100" font-family="JetBrains Mono, monospace" font-size="10" fill="#2e7d32" text-anchor="middle" font-weight="bold">只借不送</text>
    
    <text x="170" y="190" font-family="JetBrains Mono, monospace" font-size="11" fill="#455a64" text-anchor="middle">Item&lt;'a&gt; 现在能安全地“勾住” self</text>
    <text x="170" y="210" font-family="JetBrains Mono, monospace" font-size="11" fill="#455a64" text-anchor="middle">你只需提供一个观察内部数据的窗口</text>
    
    <rect x="20" y="235" width="300" height="30" fill="#e8f5e9" rx="4"/>
    <text x="170" y="255" font-family="JetBrains Mono, monospace" font-size="11" fill="#2e7d32" text-anchor="middle">优势：零拷贝，性能极致</text>
  </g>

  <!-- Section 3: The "Window" Metaphor -->
  <g transform="translate(40, 400)">
    <rect width="720" height="200" fill="#263238" rx="12"/>
    <text x="360" y="35" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#ffffff" text-anchor="middle">核心机制：动态窗口 (Lending)</text>
    
    <!-- Data Stream -->
    <rect x="60" y="60" width="600" height="40" fill="#37474f" rx="4"/>
    <text x="360" y="85" font-family="JetBrains Mono, monospace" font-size="14" fill="#90a4ae" text-anchor="middle">C O N T E N T   I N   M E M O R Y</text>
    
    <!-- Sliding Window 1 -->
    <rect x="100" y="55" width="80" height="50" fill="none" stroke="#ffcc80" stroke-width="3" rx="4">
      <animate attributeName="x" values="100;300;500;100" dur="6s" repeatCount="indefinite" />
    </rect>
    <text x="140" y="130" font-family="JetBrains Mono, monospace" font-size="12" fill="#ffcc80" text-anchor="middle">
      <tspan>Item&lt;'a1&gt;</tspan>
      <animate attributeName="x" values="140;340;540;140" dur="6s" repeatCount="indefinite" />
    </text>

    <text x="360" y="170" font-family="JetBrains Mono, monospace" font-size="13" fill="#cfd8dc" text-anchor="middle">GATs 允许 Trait 定义一种“随迭代滑动的引用窗口”。</text>
    <text x="360" y="190" font-family="JetBrains Mono, monospace" font-size="11" fill="#90a4ae" text-anchor="middle">如果没有 GATs，你无法在 Trait 层面抽象这种“滑动窗口”行为。</text>
  </g>

  <!-- Summary Footer -->
  <rect x="40" y="620" width="720" height="40" fill="#fff8e1" stroke="#ff9800" stroke-width="1" rx="6"/>
  <text x="400" y="645" font-family="JetBrains Mono, monospace" font-size="12" font-weight="bold" fill="#e65100" text-anchor="middle">结论：GATs 赋予了 Trait “描述复杂借用关系”的能力，这是构建高性能库（如零拷贝解析器、数据库驱动）的基石。</text>

  <!-- Markers -->
  <defs>
    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef5350" />
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4caf50" />
    </marker>
  </defs>
</svg>