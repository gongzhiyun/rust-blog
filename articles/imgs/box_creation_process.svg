<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
<rect x="0" y="0" width="800" height="400" rx="12" fill="#f8f9fa" stroke="#e0e0e0" stroke-width="1"/>
<!-- Title -->
<text x="400" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="18" font-weight="bold" fill="#333333">Box::new(T) 的内存分配与所有权转移</text>
<!-- Stack Section -->
<g transform="translate(50, 65)">
<rect x="0" y="0" width="300" height="300" rx="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"/>
<text x="150" y="30" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#0d47a1">Stack (栈)</text>
<!-- Step 1: Initial Value -->
<rect x="30" y="50" width="240" height="65" rx="6" fill="#fff8e1" stroke="#ff9800" stroke-width="1.5"/>
<text x="45" y="75" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#e65100">Step 1: 原始数据 T</text>
<text x="45" y="95" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">数据在栈上初始化</text>
<!-- Step 4: Final Pointer -->
<rect x="30" y="210" width="240" height="65" rx="6" fill="#ffffff" stroke="#2196f3" stroke-width="1.5"/>
<text x="45" y="235" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#0d47a1">Step 4: Box&lt;T&gt; 指针</text>
<text x="45" y="255" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">ptr: 0x7ffee1a0 (指向堆)</text>
</g>
<!-- Heap Section -->
<g transform="translate(450, 65)">
<rect x="0" y="0" width="300" height="300" rx="10" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
<text x="150" y="30" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" fill="#1b5e20">Heap (堆)</text>
<!-- Step 2: Allocation -->
<rect x="30" y="50" width="240" height="65" rx="6" fill="#ffffff" stroke="#4caf50" stroke-width="1" stroke-dasharray="4"/>
<text x="45" y="75" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1b5e20">Step 2: 分配堆空间</text>
<text x="45" y="95" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">Layout::new&lt;T&gt;()</text>
<!-- Step 3: Move to Heap -->
<rect x="30" y="150" width="240" height="85" rx="6" fill="#ffffff" stroke="#4caf50" stroke-width="2"/>
<text x="45" y="175" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1b5e20">Step 3: 内存拷贝 (Move)</text>
<text x="45" y="195" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">数据从栈拷贝到堆</text>
<text x="45" y="215" font-family="JetBrains Mono, monospace" font-size="10" fill="#78909c">addr: 0x7ffee1a0</text>
</g>
<!-- Arrows -->
<path d="M 320 135 Q 400 135 480 135" stroke="#ff9800" stroke-width="2" fill="none" stroke-dasharray="5"/>
<polygon points="480,130 490,135 480,140" fill="#ff9800"/>
<text x="400" y="125" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#e65100">1. 分配请求</text>
<path d="M 320 135 L 480 235" stroke="#9c27b0" stroke-width="3" fill="none"/>
<polygon points="475,237 485,238 480,230" fill="#9c27b0"/>
<text x="390" y="205" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="12" fill="#9c27b0" font-weight="bold">2. 数据 Move</text>
<path d="M 480 265 L 320 295" stroke="#2196f3" stroke-width="2" fill="none"/>
<polygon points="325,290 315,296 325,300" fill="#2196f3"/>
<text x="400" y="305" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#0d47a1">3. 返回指针</text>
<!-- Legend -->
<g transform="translate(50, 375)">
<rect x="0" y="0" width="15" height="15" fill="#fff8e1" stroke="#ff9800"/>
<text x="20" y="12" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">临时数据</text>
<rect x="100" y="0" width="15" height="15" fill="#ffffff" stroke="#2196f3"/>
<text x="120" y="12" font-family="JetBrains Mono, monospace" font-size="11" fill="#333333">Box 指针</text>
</g>
</svg>