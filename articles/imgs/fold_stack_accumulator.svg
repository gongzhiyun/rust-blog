<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="400" fill="#f8f9fa" />
    
    <!-- Title -->
    <text x="400" y="30" font-family="JetBrains Mono, monospace" font-size="20" font-weight="bold" text-anchor="middle" fill="#333333">fold: 栈上累加器的就地更新</text>

    <!-- Stack Frame -->
    <rect x="50" y="60" width="300" height="300" rx="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" />
    <text x="200" y="85" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#2196f3">Stack Frame (栈帧)</text>

    <!-- Accumulator -->
    <rect x="70" y="120" width="260" height="80" rx="5" fill="#fff8e1" stroke="#ff9800" stroke-width="2" />
    <text x="80" y="145" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#333333">Accumulator (acc)</text>
    <text x="80" y="175" font-family="JetBrains Mono, monospace" font-size="24" font-weight="bold" fill="#ff9800">Sum: 6</text>

    <!-- Iterator State -->
    <rect x="70" y="230" width="260" height="100" rx="5" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
    <text x="80" y="255" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#333333">Iterator State</text>
    <text x="80" y="280" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">current: index 3</text>
    <text x="80" y="305" font-family="JetBrains Mono, monospace" font-size="12" fill="#78909c">exhausted: false</text>

    <!-- Logic / Code Section -->
    <rect x="450" y="60" width="300" height="300" rx="10" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
    <text x="600" y="85" font-family="JetBrains Mono, monospace" font-size="16" font-weight="bold" text-anchor="middle" fill="#9c27b0">Code Area (逻辑内联)</text>

    <!-- Loop Logic -->
    <rect x="470" y="110" width="260" height="230" rx="5" fill="#ffffff" stroke="#e0e0e0" stroke-width="1" />
    <text x="480" y="140" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333" font-weight="bold">while let Some(item) = next() {</text>
    <text x="500" y="170" font-family="JetBrains Mono, monospace" font-size="12" fill="#9c27b0">    // 闭包逻辑就地展开</text>
    <text x="500" y="200" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">    acc = acc + item;</text>
    <text x="480" y="230" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">}</text>

    <!-- Update Arrow -->
    <path d="M 470 200 Q 380 200 330 170" fill="none" stroke="#ff9800" stroke-width="2" marker-end="url(#arrowhead_orange)" />
    <text x="370" y="220" font-family="JetBrains Mono, monospace" font-size="12" fill="#ff9800" text-anchor="middle">就地更新 (In-place)</text>

    <!-- Data Fetch Arrow -->
    <path d="M 470 140 Q 380 140 330 250" fill="none" stroke="#2196f3" stroke-width="2" marker-start="url(#arrowhead_blue)" />
    <text x="370" y="130" font-family="JetBrains Mono, monospace" font-size="12" fill="#2196f3" text-anchor="middle">拉取数据</text>

    <!-- Definitions -->
    <defs>
        <marker id="arrowhead_orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
        <marker id="arrowhead_blue" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
            <polygon points="10 0, 0 3.5, 10 7" fill="#2196f3" />
        </marker>
    </defs>
</svg>
