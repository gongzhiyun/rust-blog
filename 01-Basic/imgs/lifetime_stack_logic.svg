<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="400" viewBox="0 0 800 400" fill="none" xmlns="http://www.w3.org/2000/svg" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
    <!-- Background -->
    <rect width="800" height="400" rx="15" fill="#f8f9fa"/>
    
    <!-- Title -->
    <text x="400" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="22" font-weight="bold" fill="#333333">悬垂引用：内存释放后的幽灵访问</text>

    <!-- Stack Region -->
    <g transform="translate(50, 60)">
        <rect width="320" height="300" rx="12" fill="#ffffff" stroke="#e0e0e0" stroke-width="1"/>
        <path d="M0 12C0 5.37258 5.37258 0 12 0H308C314.627 0 320 5.37258 320 12V35H0V12Z" fill="#e3f2fd"/>
        <text x="160" y="23" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#1565c0">Stack (栈内存)</text>

        <!-- main scope -->
        <rect x="20" y="50" width="280" height="230" rx="8" fill="#fafafa" stroke="#1565c0" stroke-dasharray="4 2"/>
        <text x="30" y="65" font-family="JetBrains Mono, monospace" font-size="11" fill="#1565c0">fn main()</text>

        <!-- r variable -->
        <rect x="40" y="80" width="240" height="40" rx="4" fill="#fff8e1" stroke="#ff9800"/>
        <text x="50" y="105" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">let r: &amp;i32</text>
        <circle cx="260" cy="100" r="3" fill="#ff9800"/>

        <!-- inner scope -->
        <g id="inner-scope">
            <rect x="40" y="140" width="240" height="120" rx="8" fill="#ffffff" stroke="#ef5350"/>
            <text x="50" y="155" font-family="JetBrains Mono, monospace" font-size="11" fill="#ef5350">Inner Scope { ... }</text>
            
            <!-- x variable -->
            <rect x="60" y="170" width="200" height="40" rx="4" fill="#fafafa" stroke="#e0e0e0"/>
            <text x="70" y="195" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">let x = 42;</text>
            <rect x="220" y="175" width="30" height="30" rx="2" fill="#e8f5e9" stroke="#4caf50"/>
            <text x="235" y="195" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#2e7d32">42</text>
        </g>
    </g>

    <!-- Code & Logic Region -->
    <g transform="translate(420, 60)">
        <rect width="330" height="300" rx="12" fill="#ffffff" stroke="#e0e0e0" stroke-width="1"/>
        <path d="M0 12C0 5.37258 5.37258 0 12 0H318C324.627 0 330 5.37258 330 12V35H0V12Z" fill="#f3e5f5"/>
        <text x="165" y="23" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" font-weight="bold" fill="#6a1b9a">执行逻辑与崩溃点</text>

        <!-- Step 1 -->
        <text x="20" y="70" font-family="JetBrains Mono, monospace" font-size="12" fill="#333333">1. r 指向 x 的地址</text>
        <path d="M-110 100 C -50 100, -50 190, 80 190" stroke="#ff9800" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

        <!-- Step 2 -->
        <text x="20" y="130" font-family="JetBrains Mono, monospace" font-size="12" fill="#ef5350" font-weight="bold">2. 内部作用域结束</text>
        <text x="40" y="150" font-family="JetBrains Mono, monospace" font-size="11" fill="#666666">变量 x 被弹出 (Drop)</text>
        <path d="M60 180 L 100 220 M 100 180 L 60 220" stroke="#ef5350" stroke-width="3" transform="translate(-200, 10)"/>

        <!-- Step 3 -->
        <text x="20" y="210" font-family="JetBrains Mono, monospace" font-size="12" fill="#d32f2f" font-weight="bold">3. 悬垂指针 (Dangling)!</text>
        <text x="40" y="230" font-family="JetBrains Mono, monospace" font-size="11" fill="#666666">r 依然存活，但指向的内存已失效</text>
        
        <rect x="20" y="250" width="290" height="35" rx="4" fill="#ffebee" stroke="#ef5350" stroke-dasharray="4 2"/>
        <text x="165" y="272" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="12" fill="#c62828">借用检查器：阻止编译！</text>
    </g>

    <!-- Arrow Definition -->
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#ff9800" />
        </marker>
    </defs>
</svg>